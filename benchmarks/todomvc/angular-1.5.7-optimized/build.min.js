(function(){"use strict";angular.module("todoCtrl",[]).controller("TodoCtrl",function TodoCtrl($scope,$location,todoStorage){var TC=this;var todos=TC.todos=todoStorage.get();TC.ESCAPE_KEY=27;TC.editedTodo={};TC.updateAndStore=function(){TC.remainingCount=todos.filter(function(todo){return!todo.completed}).length;TC.allChecked=TC.remainingCount===0;var todosToSave=todos.map(function(todo){return{title:todo.title,completed:todo.completed}});todoStorage.put(todosToSave)};function resetTodo(){TC.newTodo={title:"",completed:false}}resetTodo();if($location.path()===""){$location.path("/")}TC.location=$location;$scope.$watch("TC.location.path()",function(path){TC.statusFilter={"/active":{completed:false},"/completed":{completed:true}}[path]});TC.addTodo=function(){var newTitle=TC.newTodo.title=TC.newTodo.title.trim();if(newTitle.length===0){return}todos.push(TC.newTodo);resetTodo();TC.updateAndStore()};TC.editTodo=function(todo){TC.editedTodo=todo;TC.originalTodo=angular.copy(todo)};TC.doneEditing=function(todo,index){TC.editedTodo={};todo.title=todo.title.trim();if(!todo.title){TC.removeTodo(index)}TC.updateAndStore()};TC.revertEditing=function(index){TC.editedTodo={};todos[index]=TC.originalTodo;TC.updateAndStore()};TC.removeTodo=function(index){todos.splice(index,1);TC.updateAndStore()};TC.clearCompletedTodos=function(){TC.todos=todos=todos.filter(function(val){return!val.completed});TC.updateAndStore()};TC.markAll=function(completed){todos.forEach(function(todo){todo.completed=completed});TC.updateAndStore()}});angular.module("todoFocus",[]).directive("todoFocus",function($timeout){return function(scope,elem,attrs){scope.$watch(attrs.todoFocus,function(newVal){if(newVal){$timeout(function(){elem[0].focus()},0,false)}})}});angular.module("todoStorage",[]).factory("todoStorage",function(){var STORAGE_ID="todos-angularjs-perf";return{get:function(){return JSON.parse(localStorage.getItem(STORAGE_ID)||"[]")},put:function(todos){localStorage.setItem(STORAGE_ID,JSON.stringify(todos))}}});angular.module("todomvc",["todoCtrl","todoFocus","todoStorage"])})();